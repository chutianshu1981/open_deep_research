# Open Deep Research 环境配置指南

## 问题解决

刚才遇到的错误是因为 `LANGSMITH_TRACING` 环境变量值为空字符串，但系统期望布尔值。我已经将其修复为 `false`。

## 环境变量配置

### 必需的 API 密钥

为了正常运行 Open Deep Research，你需要配置以下 API 密钥：

#### 1. 模型提供商 API 密钥（至少需要一个）

**OpenAI API 密钥**：
```bash
OPENAI_API_KEY=your_openai_api_key_here
```
- 获取地址：https://platform.openai.com/api-keys
- 支持模型：GPT-4、GPT-4 Turbo、GPT-3.5 等
- 推荐用于：默认配置，支持所有功能

**Anthropic API 密钥**：
```bash
ANTHROPIC_API_KEY=your_anthropic_api_key_here
```
- 获取地址：https://console.anthropic.com/
- 支持模型：Claude 3.5 Sonnet、Claude 3 Opus 等
- 特色功能：原生网络搜索支持

**Google API 密钥**：
```bash
GOOGLE_API_KEY=your_google_api_key_here
```
- 获取地址：https://console.cloud.google.com/
- 支持模型：Gemini Pro、Gemini Ultra 等
- 注意：需要启用 Vertex AI API

#### 2. 搜索 API 密钥（推荐）

**Tavily API 密钥**：
```bash
TAVILY_API_KEY=your_tavily_api_key_here
```
- 获取地址：https://tavily.com/
- 特点：通用搜索，支持所有模型
- 推荐：最佳兼容性选择

#### 3. LangSmith 配置（可选，用于追踪和调试）

```bash
LANGSMITH_API_KEY=your_langsmith_api_key_here
LANGSMITH_PROJECT=your_project_name
LANGSMITH_TRACING=false  # 本地开发设为 false，生产环境可设为 true
```
- 获取地址：https://smith.langchain.com/
- 用途：追踪智能体执行过程，调试和优化

### 当前 .env 文件状态

```bash
OPENAI_API_KEY=                    # 需要填入你的 OpenAI API 密钥
ANTHROPIC_API_KEY=                 # 需要填入你的 Anthropic API 密钥
GOOGLE_API_KEY=                    # 需要填入你的 Google API 密钥
TAVILY_API_KEY=                    # 需要填入你的 Tavily API 密钥
LANGSMITH_API_KEY=                 # 可选：LangSmith API 密钥
LANGSMITH_PROJECT=                 # 可选：LangSmith 项目名称
LANGSMITH_TRACING=false            # ✅ 已修复：设置为 false

# Only necessary for Open Agent Platform
SUPABASE_KEY=                      # 仅 OAP 部署需要
SUPABASE_URL=                      # 仅 OAP 部署需要
GET_API_KEYS_FROM_CONFIG=false     # 本地开发保持 false
```

## 快速启动建议

### 最小配置（仅用于测试）

如果你只是想快速测试项目，至少需要配置：

1. **一个模型 API 密钥**（推荐 OpenAI）
2. **一个搜索 API 密钥**（推荐 Tavily）

示例：
```bash
OPENAI_API_KEY=sk-your-openai-key-here
TAVILY_API_KEY=tvly-your-tavily-key-here
LANGSMITH_TRACING=false
GET_API_KEYS_FROM_CONFIG=false
```

### 完整配置（推荐）

为了体验所有功能，建议配置：
```bash
OPENAI_API_KEY=sk-your-openai-key-here
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here
TAVILY_API_KEY=tvly-your-tavily-key-here
LANGSMITH_API_KEY=ls-your-langsmith-key-here
LANGSMITH_PROJECT=open-deep-research
LANGSMITH_TRACING=false
GET_API_KEYS_FROM_CONFIG=false
```

## 重新启动服务

修复环境变量后，重新运行启动命令：

```bash
uvx --refresh --from "langgraph-cli[inmem]" --with-editable . --python 3.11 langgraph dev --allow-blocking
```

## 常见问题解决

### 1. 布尔值配置错误
**错误**：`Not a valid bool`
**解决**：确保布尔值设置为 `true` 或 `false`，不能为空

### 2. API 密钥无效
**错误**：`Authentication failed`
**解决**：检查 API 密钥是否正确，是否有足够的配额

### 3. 模型不支持功能
**错误**：`Model does not support structured outputs`
**解决**：确保使用支持结构化输出的模型版本

### 4. 搜索 API 兼容性
**错误**：搜索功能不工作
**解决**：
- Tavily：适用于所有模型
- OpenAI 搜索：仅适用于 OpenAI 模型
- Anthropic 搜索：仅适用于 Anthropic 模型

## 安全注意事项

1. **不要提交 API 密钥**：确保 `.env` 文件在 `.gitignore` 中
2. **定期轮换密钥**：定期更新 API 密钥
3. **限制权限**：为 API 密钥设置适当的权限和配额
4. **监控使用**：定期检查 API 使用情况和费用

## 下一步

配置完成后，你可以：

1. **启动服务**：运行 LangGraph 开发服务器
2. **访问 Studio**：在浏览器中打开 LangGraph Studio
3. **测试功能**：提交一个简单的研究问题
4. **查看日志**：观察智能体的执行过程
5. **调整配置**：根据需要修改模型和搜索设置

## 获取 API 密钥的链接

- **OpenAI**: https://platform.openai.com/api-keys
- **Anthropic**: https://console.anthropic.com/
- **Google Cloud**: https://console.cloud.google.com/
- **Tavily**: https://tavily.com/
- **LangSmith**: https://smith.langchain.com/

配置完成后，重新运行启动命令即可正常使用 Open Deep Research！
