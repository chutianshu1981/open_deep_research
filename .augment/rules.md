# Augment Rules for Open Deep Research Project

## 项目概述
这是一个基于 LangGraph 的开源深度研究智能体系统，支持多模型提供商、多搜索工具和 MCP 服务器集成。

## 代码风格和约定

### Python 代码规范
- 使用 Ruff 进行代码检查和格式化
- 遵循 Google 风格的文档字符串
- 使用 Pydantic 进行数据验证和配置管理
- 优先使用类型注解

### 架构模式
- 基于 LangGraph 的状态图架构
- 使用 Pydantic BaseModel 定义状态和配置
- 异步编程模式处理并发研究
- 配置驱动的模型和工具选择

## 核心组件说明

### 主要模块结构
```
src/open_deep_research/
├── deep_researcher.py    # 主要研究智能体逻辑
├── configuration.py      # 配置管理
├── state.py             # 状态定义
├── prompts.py           # 提示词模板
└── utils.py             # 工具函数
```

### 关键类和函数
- `Configuration`: 系统配置管理，支持环境变量和运行时配置
- `AgentState`: 主要的智能体状态定义
- `configurable_model`: 可配置的模型初始化
- `clarify_with_user`: 用户澄清流程
- `conduct_research`: 研究执行逻辑

## 开发指南

### 添加新功能时
1. 优先考虑配置驱动的设计
2. 使用结构化输出和 Pydantic 模型
3. 支持异步操作
4. 添加适当的错误处理和重试机制
5. 更新相关的提示词模板

### 模型集成
- 使用 `init_chat_model()` API 进行模型初始化
- 确保模型支持结构化输出和工具调用
- 考虑不同模型的 token 限制和特殊要求
- 为新模型添加相应的配置选项

### 搜索API集成
- 支持 Tavily、OpenAI、Anthropic 原生搜索
- 实现统一的搜索接口
- 处理不同API的认证和限制
- 添加搜索结果的标准化处理

### MCP服务器集成
- 支持本地和远程MCP服务器
- 实现认证和安全机制
- 提供工具发现和调用接口
- 处理MCP服务器的生命周期管理

## 测试和评估

### 测试策略
- 使用 pytest 进行单元测试
- 实现批量评估系统
- 支持多维度评分
- 提供对比评估功能

### 评估指标
- 研究质量评估
- 响应时间性能
- 并发处理能力
- 模型成本效率

## 部署考虑

### 环境配置
- 使用 `.env` 文件管理API密钥
- 支持多种部署环境
- 配置验证和错误处理

### 性能优化
- 并发研究单元管理
- 智能的速率限制
- 结果缓存和压缩
- 内存使用优化

## 扩展指南

### 添加新的搜索提供商
1. 在 `SearchAPI` 枚举中添加新选项
2. 实现搜索接口
3. 更新配置验证逻辑
4. 添加相应的工具函数

### 自定义MCP服务器
1. 实现MCP协议接口
2. 添加认证机制
3. 定义工具和资源
4. 集成到主要工作流程

### 新模型支持
1. 验证模型能力（结构化输出、工具调用）
2. 添加模型特定配置
3. 实现API密钥管理
4. 测试兼容性

## 常见问题和解决方案

### 模型兼容性
- 确保模型支持结构化输出
- 验证工具调用能力
- 检查搜索API兼容性
- 处理模型特定的限制

### 性能问题
- 监控并发研究单元数量
- 优化提示词长度
- 实现智能重试机制
- 使用适当的模型大小

### 配置管理
- 使用环境变量进行敏感信息
- 提供合理的默认值
- 实现配置验证
- 支持运行时配置更新
